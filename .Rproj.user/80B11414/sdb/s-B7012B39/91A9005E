{
    "collab_server" : "",
    "contents" : "# Get housing data for 2017 to explore\nlibrary(httr)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(readr)\nlibrary(reshape2)\nlibrary(purrr)\n# Use the txt file as it seems to work better without the \" characters \n# in the csv\n#url <- \"http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-2017.txt\"\n#url <- \"http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-2016.txt\"\n#download.file(url, \"pp-2017.txt\", method = \"wget\")\n\n# Read in file from .txt\n#df <- read_delim(\"pp-2017.txt\", \n                 # delim = \",\",\n                 # col_names = FALSE,\n                 # quoted_na = FALSE)\n\n# Tidy up column classes and names\n# df$X5 <- as.factor(df$X5)\n# df$X6 <- as.factor(df$X6)\n# df$X7 <- as.factor(df$X7)\n# \n# df <- rename(df, tuid = X1, price = X2, date_of_transfer = X3, postcode = X4,\n#              property_type = X5, old_new = X6, duration = X7, paon = X8,\n#              saon = X9, street = X10, locality = X11, town = X12, district = X13,\n#              county = X14, ppd_type = X15, record_status = X16) %>% \n#     separate(postcode, \n#              into = c(\"outcode\", \"incode\"), \n#              sep = \"\\\\ \",\n#              extra = \"merge\",\n#              fill = \"right\") %>% \n#     select(price, date_of_transfer, \n#            outcode, \n#            incode,\n#            property_type, \n#            everything())\n# \n# head(df)\n# \n# by_outcode_type <- df %>% \n#     group_by(outcode, property_type) %>% \n#     summarise(n = n(),\n#               avg_price = mean(price), \n#               sd = sd(price), \n#               threshold = quantile(price, 0.3))\n# \n# head(by_outcode_type, n = 200)\n\nyears <- seq(2012, 2016)\nmake_url <- function(year) {\n    paste(\"http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-\",\n          year,\n          \".txt\",\n          sep = \"\")\n}\nurls <- map(years, make_url)\n\nmap(urls, function(x) {\n    download.file(x, basename(x))\n})\n\nmake_filename <- function(year) {\n    paste(\"pp-\",\n          year,\n          \".txt\",\n          sep = \"\")\n}\n\nfilenames <- map(years, make_filename)\n\ndatalist <- lapply(filenames, function(x) read_delim(x, \n                                                     delim = \",\",\n                                                     col_names = FALSE,\n                                                     quoted_na = FALSE))\n\nfull_data <- do.call(\"rbind\", datalist)\n\n# df_2012 <- read_delim(\"pp-2012.txt\", \n#                       delim = \",\",\n#                       col_names = FALSE,\n#                       quoted_na = FALSE)\n# \n# df_2013 <- read_delim(\"pp-2013.txt\", \n#                       delim = \",\",\n#                       col_names = FALSE,\n#                       quoted_na = FALSE)\n# \nfull_data$X5 <- as.factor(full_data$X5)\nfull_data$X6 <- as.factor(full_data$X6)\nfull_data$X7 <- as.factor(full_data$X7)\n\nfull_data <- rename(full_data, tuid = X1, price = X2, date_of_transfer = X3, \n                    postcode = X4, property_type = X5, old_new = X6, \n                    duration = X7, paon = X8,saon = X9, \n                    street = X10, locality = X11, town = X12, \n                    district = X13, county = X14, ppd_type = X15, \n                    record_status = X16) %>% \n    separate(postcode, \n             into = c(\"outcode\", \"incode\"), \n             sep = \"\\\\ \",\n             extra = \"merge\",\n             fill = \"right\") %>% \n    select(price, date_of_transfer, \n           outcode, \n           incode,\n           property_type, \n           everything())\n\nhead(full_data)\n\nby_outcode_type <- full_data %>% \n    group_by(outcode, property_type) %>% \n    summarise(n = n(),\n              avg_price = mean(price), \n              sd = sd(price), \n              threshold = quantile(price, 0.3))\n\nhead(by_outcode_type, n = 200)\n\nwrite_excel_csv(by_outcode_type, \"summarised_housing_data.csv\")\n",
    "created" : 1490676356353.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3756076433",
    "id" : "91A9005E",
    "lastKnownWriteTime" : 1490677925,
    "last_content_update" : 1490677925647,
    "path" : "~/github/housing_data/housing_data_wrangling_2017-03-27.R",
    "project_path" : "housing_data_wrangling_2017-03-27.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}